-------------------------------------------------------------------------------
// 代码结构
ngx_http_doc_module.cc {
	
	// whngx_doc_init_process, worker进程启动时初始化全局变量
	whngx_init.cc {
		db_mysql.cc     // 连接MySQL
	}
	
	// ngx_http_doc_handler, HTTP模块处理函数
	whngx_handler.cc {
		whdoc_action.h  // Action处理函数的声明
		regist.cc       // 注册
		loginreq.cc     // 登录请求
		login.cc        // 登录
		list_doc.cc     // 文档列表
	}
}


-------------------------------------------------------------------------------
// 配置文件
		location = /doc/regist {
			doc;
			limit_except POST {
				deny all;
			}
			client_max_body_size 1k;
		}
		
		location = /doc/loginreq {
			doc;
			limit_except POST {
				deny all;
			}
			client_max_body_size 1k;
		}
		
		location = /doc/login {
			doc;
			limit_except POST {
				deny all;
			}
			client_max_body_size 1k;
		}
		
		location = /doc/list_doc {
			doc;
			limit_except POST {
				deny all;
			}
			client_max_body_size 1k;
		}


-------------------------------------------------------------------------------
// 构建和安装
sudo apt-get install mysql-server
sudo apt-get install mysql-client
sudo apt-get install libmysqlclient-dev
sudo apt-get install uuid-dev

./configure --add-module=whngx/doc/src

CXX = g++ -Iwhngx/doc/ext -Iwhngx/doc/include
LINK =	$(CXX)  ## -lmysqlclient -luuid

在文件conf/make, 第396行, 改"\$(CC)"成"\$(CXX)"
# the addons sources
if test -n "$NGX_ADDON_SRCS"; then
    ngx_cc="\$(CXX) $ngx_compile_opt \$(CFLAGS) $ngx_use_pch \$(ALL_INCS)"


-------------------------------------------------------------------------------
// 功能处理流程
1. regist
	C (username, password)=> S
	S (username, cxx, ixx, cuu)=>loginreq
	  (iuu, uid)=>login
	S (ok)=> C

2. loginreq
	C (username)=> S
	S (cxx, ixx)=> C

3. login
	C (username, cuu1, iuu1)=> S
	S check cuu1==cuu; then get uid
	S generate random code; then (id, uid, code, now_time)=>idcheck
	S (id, code)=> C

4. check-id
	select uid from idcheck
		where id='id' and code='code' and time_to_sec(now())-time_to_sec(time)<3600